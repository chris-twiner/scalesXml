
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://scalesxml.github.io/scales-xml_2.10/0.6.0-M5/Getting_Started/release_notes/0.6.0/" rel="canonical"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.2" name="generator"/>
<title>0.6.0 - Scales Xml</title>
<link href="../../../assets/stylesheets/main.7bf56d0a.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#scalaz-iteratee">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Scales Xml" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Scales Xml">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Scales Xml
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              0.6.0
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/chris-twiner/scalesXml/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    scales-xml
  </div>
</a>
</div>
<a class="md-header__button md-header-nav__button md-icon" href="../../../pdf/document.pdf" title="PDF">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
<path d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z" fill="#E2E5E7"></path>
<path d="m384 128h96l-128-128v96c0 17.6 14.4 32 32 32z" fill="#B0B7BD"></path>
<polygon fill="#CAD1D8" points="480 224 384 128 480 128"></polygon>
<path d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16  V416z" fill="#F15642"></path>
<g fill="#fff">
<path d="m101.74 303.15c0-4.224 3.328-8.832 8.688-8.832h29.552c16.64 0 31.616 11.136 31.616 32.48 0 20.224-14.976 31.488-31.616 31.488h-21.36v16.896c0 5.632-3.584 8.816-8.192 8.816-4.224 0-8.688-3.184-8.688-8.816v-72.032zm16.88 7.28v31.872h21.36c8.576 0 15.36-7.568 15.36-15.504 0-8.944-6.784-16.368-15.36-16.368h-21.36z"></path>
<path d="m196.66 384c-4.224 0-8.832-2.304-8.832-7.92v-72.672c0-4.592 4.608-7.936 8.832-7.936h29.296c58.464 0 57.184 88.528 1.152 88.528h-30.448zm8.064-72.912v57.312h21.232c34.544 0 36.08-57.312 0-57.312h-21.232z"></path>
<path d="m303.87 312.11v20.336h32.624c4.608 0 9.216 4.608 9.216 9.072 0 4.224-4.608 7.68-9.216 7.68h-32.624v26.864c0 4.48-3.184 7.92-7.664 7.92-5.632 0-9.072-3.44-9.072-7.92v-72.672c0-4.592 3.456-7.936 9.072-7.936h44.912c5.632 0 8.96 3.344 8.96 7.936 0 4.096-3.328 8.704-8.96 8.704h-37.248v0.016z"></path>
</g>
<path d="m400 432h-304v16h304c8.8 0 16-7.2 16-16v-16c0 8.8-7.2 16-16 16z" fill="#CAD1D8"></path>
</svg>
</a></nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
      Scales XML
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../ScalesXmlIntro/">
        Getting Started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Parsing_XML/FullParsing/">
        Parsing XML
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Accessing_and_Querying_Data/XPaths/">
        Accessing and Querying Data
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Serializing_%26_Transforming_XML/SerializingIntro/">
        Serializing &amp; Transforming XML
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Advanced/Technical_Details/OptimisationDetails/">
        Advanced
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../site/scales-xml_2.12/scaladocs/">
        Reference Material
      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Scales Xml" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Scales Xml">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Scales Xml
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/chris-twiner/scalesXml/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    scales-xml
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Scales XML
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ScalesXmlIntro/">
        Scales Xml Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Setup/">
        Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../HowToUse/">
        How To Use
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../MemoryOptimisation/">
        Scales Xml Optimisation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        None
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
          XML Model
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
          XML Model
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../XML_Model/QNames/">
        QNames
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../XML_Model/Elem/">
        Elem
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../XML_Model/Attributes/">
        Attributes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../XML_Model/XmlItem/">
        XmlItem
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../XML_Model/XmlDsl/">
        Xml DSL and Trees
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../XML_Model/OptionalDsl/">
        Optional Xml DSL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../XML_Model/XmlVersionSupport/">
        Scales XML Version Support
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Parsing XML
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Parsing XML
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Parsing_XML/FullParsing/">
        Full XML Doc Parsing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Parsing_XML/PullParsing/">
        Pull Parsing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Parsing_XML/RepeatedSections/">
        Pulling Repeated Sections
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Parsing_XML/AsyncPull/">
        Async Pull
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Accessing and Querying Data
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Accessing and Querying Data
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Accessing_and_Querying_Data/XPaths/">
        XPath Embedded DSL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Accessing_and_Querying_Data/XPathFunctions/">
        XPath Functions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Accessing_and_Querying_Data/StringXPaths/">
        XPath 1.0 String Evaluation
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Serializing &amp; Transforming XML
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Serializing &amp; Transforming XML
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Serializing_%26_Transforming_XML/SerializingIntro/">
        An Introduction to Serializing Xml With Scales
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Serializing_%26_Transforming_XML/Folding/">
        Folding Xml
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Serializing_%26_Transforming_XML/XSLT/">
        TrAX &amp; XSLT Support
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          Technical Details
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_1">
<span class="md-nav__icon md-icon"></span>
          Technical Details
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Advanced/Technical_Details/OptimisationDetails/">
        Scales Xml Optimisation Details
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Advanced/Technical_Details/Serialization/">
        Serialising - Nitty Gritty
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          XML Equality
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
          XML Equality
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Advanced/XML_Equality/EqualityBasics/">
        XML Equality Basics
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Advanced/XML_Equality/XmlComparison/">
        XmlComparison - What, Where &amp; How Was It Different
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Reference Material
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Reference Material
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
          Scaladocs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_1">
<span class="md-nav__icon md-icon"></span>
          Scaladocs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../site/scales-xml_2.12/scaladocs/">
        scales-xml
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../site/scales-xml-jaxen_2.12/scaladocs/">
        scales-xml-jaxen
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../site/scales-xml-aalto_2.12/scaladocs/">
        scales-xml-aalto
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          Maven
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
          Maven
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../site/">
        Root
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../site/scales-xml_2.12/">
        scales-xml
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../site/scales-xml-jaxen_2.12/">
        scales-xml-jaxen
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../site/scales-xml-aalto_2.12/">
        scales-xml-aalto
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#scalaz-iteratee">
    Scalaz Iteratee
  </a>
<nav aria-label="Scalaz Iteratee" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#foldi-foldim-and-repeatuntil-repeatuntilm">
    foldI, foldIM and repeatUntil / repeatUntilM
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upgrading-to-monadic-usage">
    Upgrading to Monadic usage
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#a-note-on-id-trampoline-and-io">
    A note on Id, Trampoline and IO
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#beware-the-iterator">
    BEWARE THE ITERATOR
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#beware-side-effecting-output-state-as-well">
    Beware Side Effecting Output State as well
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scala-213-support">
    Scala 2.13 support
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>0.6.0</h1>
<p>The 0.6.0 release removes support for scala versions below 2.11, migrates to scalaz-iteratees and adds support for 2.13's new collection approach.</p>
<p>Build wise it's moved to maven and github actions to simplify rolling out any future fixes, similarly the docs have migrated from the home-brew site builder to mkdocs.  The feature scope is: </p>
<ol>
<li><a class="magiclink magiclink-github magiclink-issue" href="https://github.com/sparkutils/quality/issues/51" title="GitHub Issue: sparkutils/quality #51">#51</a> - Migration from the old IterV to the newer Scalaz iteratee library</li>
<li><a class="magiclink magiclink-github magiclink-issue" href="https://github.com/sparkutils/quality/issues/52" title="GitHub Issue: sparkutils/quality #52">#52</a> - Scala 2.13 support</li>
</ol>
<h2 id="scalaz-iteratee">Scalaz Iteratee<a class="headerlink" href="#scalaz-iteratee" title="Permanent link">¶</a></h2>
<p>The pull api (and async pull api) have changed to be fully monadic and will require code changes, the default Id implementation is not (always) tail recursive and leads to SOEs - as such the iteratees are no longer imported by utils._ directly you must choose the right import for your use case.  The PullTest.testFoldOnDoneId for example will fail on 2.11 and 2.12, but sometimes works on 2.13 when running all tests (despite having the same scalaz version as 2.12), so ymmv across runtimes.</p>
<p>Iteratee[E,A] is a type alias for IterateeT[E,Id,A] so everything is "wrapped" in an Id container (Id[X]=X), as such you may need to specify an appropriate Monad type to get a proper compilation and runtime behaviour, e.g. IO or Trampoline.  Indeed, if the compiler doesn't present an error it's typically derived as Id, which can SOE.</p>
<p>To aid in this, and type-inference given a specific monad, the following helper function and defaults are provided:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iterateesOf</span><span class="p">[</span><span class="nc">F</span><span class="p">[</span><span class="n">_</span><span class="p">]]:</span><span class="w"> </span><span class="nc">IterateeFunctions</span><span class="p">[</span><span class="nc">F</span><span class="p">]</span>

<span class="kd">val</span><span class="w"> </span><span class="n">ioIteratees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterateesOf</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span>
<span class="kd">val</span><span class="w"> </span><span class="n">trampolineIteratees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterateesOf</span><span class="p">[</span><span class="nc">Trampoline</span><span class="p">]</span>
<span class="c1">// not recommended but may help migrations</span>
<span class="kd">val</span><span class="w"> </span><span class="n">idIteratees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterateesOf</span><span class="p">[</span><span class="nc">Id</span><span class="p">]</span>

<span class="c1">// similarly</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pullIterateesOf</span><span class="p">[</span><span class="nc">F</span><span class="p">[</span><span class="n">_</span><span class="p">]]:</span><span class="w"> </span><span class="nc">PullIterateeFunctions</span><span class="p">[</span><span class="nc">F</span><span class="p">]</span>

<span class="kd">val</span><span class="w"> </span><span class="n">ioPullIteratees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pullIterateesOf</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span>
<span class="kd">val</span><span class="w"> </span><span class="n">trampolinePullIteratees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pullIterateesOf</span><span class="p">[</span><span class="nc">Trampoline</span><span class="p">]</span>
<span class="c1">// not recommended but may help migrations</span>
<span class="kd">val</span><span class="w"> </span><span class="n">idPullIteratees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pullIterateesOf</span><span class="p">[</span><span class="nc">Id</span><span class="p">]</span>
</code></pre></div>
<p>The functions in IterateeFunctions already have F captured with the type TheF (although F is not stored as an implicit given conflicts with import Scalaz._). So using:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">utils</span><span class="p">.</span><span class="nn">trampolineIteratees</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">xml</span><span class="p">.</span><span class="nn">trampolinePullIteratees</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">utils</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">xml</span><span class="p">.</span><span class="n">_</span>
</code></pre></div>
<p>will bring in the iteratee functions already defined within Trampoline, allowing better type inference (you may need to have the imports at different scopes to properly shadow).</p>
<p>If your code can benefit from either specifying the monad at use site or type inference you can import the base functions with F[_] type parameters via:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">utils</span><span class="p">.</span><span class="nn">iteratee</span><span class="p">.</span><span class="nn">functions</span><span class="p">.</span><span class="n">_</span>
</code></pre></div>
<details class="info"><summary>Diverging implicit expansion for type scalaz..</summary><p>This is probably occurring as you have imported the functions twice for different monads or the underlying functions. In order to ensure the type derivation is correct for the implicits you are best defining them at the use site directly e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">utils</span><span class="p">.</span><span class="nn">trampolineIteratees</span><span class="p">.</span><span class="n">_</span>

<span class="kd">val</span><span class="w"> </span><span class="n">iter</span><span class="p">:</span><span class="w"> </span><span class="nc">IterateeT</span><span class="p">[</span><span class="nc">PullType</span><span class="p">,</span><span class="w"> </span><span class="nc">TheF</span><span class="p">,</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">PullType</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">peek</span><span class="p">[</span><span class="nc">PullType</span><span class="p">,</span><span class="w"> </span><span class="nc">TheF</span><span class="p">]</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">peek</span><span class="p">[</span><span class="nc">PullType</span><span class="p">,</span><span class="w"> </span><span class="nc">TheF</span><span class="p">]</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">peek</span><span class="p">[</span><span class="nc">PullType</span><span class="p">,</span><span class="w"> </span><span class="nc">TheF</span><span class="p">]</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">peek</span><span class="p">[</span><span class="nc">PullType</span><span class="p">,</span><span class="w"> </span><span class="nc">TheF</span><span class="p">]</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">peek</span><span class="p">[</span><span class="nc">PullType</span><span class="p">,</span><span class="w"> </span><span class="nc">TheF</span><span class="p">]</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">evalWith</span><span class="p">((</span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="nc">PullType</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">p</span>
<span class="w">    </span><span class="p">})(</span><span class="n">implicitly</span><span class="p">[</span><span class="nc">Applicative</span><span class="p">[</span><span class="nc">TheF</span><span class="p">]])</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dropWhile</span><span class="p">((</span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="nc">PullType</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">p</span><span class="p">.</span><span class="n">fold</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">x</span><span class="p">.</span><span class="k">isInstanceOf</span><span class="p">[</span><span class="nc">Elem</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="p">})(</span><span class="n">implicitly</span><span class="p">[</span><span class="nc">Monad</span><span class="p">[</span><span class="nc">TheF</span><span class="p">]])</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="n">j</span>
</code></pre></div>
</details>
<p>Direct usage of iteratee's largely involves swapping Cont and Done for cont and done and migrating enumeratee / run usage to:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">iteratee</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">iteratorEnumerator</span><span class="p">(</span><span class="n">pull</span><span class="p">.</span><span class="n">it</span><span class="p">))</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>
<p>instead of</p>
<div class="highlight"><pre><span></span><code><span class="n">iteratee</span><span class="p">(</span><span class="n">pull</span><span class="p">.</span><span class="n">it</span><span class="p">)</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>
<p>this is because enumerators are no longer implicitly bound, using the monad type directly can notably increase verbosity.  Scalaz now provides a good selection of useful starting enumerators.</p>
<h3 id="foldi-foldim-and-repeatuntil-repeatuntilm">foldI, foldIM and repeatUntil / repeatUntilM<a class="headerlink" href="#foldi-foldim-and-repeatuntil-repeatuntilm" title="Permanent link">¶</a></h3>
<p>foldI and foldIM have an additional stopOn parameter alongside the init starter parameter, by default both functions will, as before, stop on each done.  This can be overridden to allow control of when to trigger done based on the ACC type.</p>
<p>This pattern is used to implement foldOnDone and a number of tests via a repeat EnumeratorT, as such it has a new function repeatUntil[M] which mimics a do while loop / repeat until loop.  i.e. the following are equivalent:</p>
<div class="highlight"><pre><span></span><code><span class="n">repeatUntilM</span><span class="p">((</span><span class="n">initAcc</span><span class="p">,</span><span class="w"> </span><span class="n">starter</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">))(</span><span class="n">a</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">step</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">itr</span><span class="p">.</span><span class="n">value</span>
<span class="w">      </span><span class="n">isdone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDoneS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="w">      </span><span class="n">iseof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isEOFS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

<span class="w">      </span><span class="n">shouldStop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>

<span class="w">      </span><span class="n">res</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isdone</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">iseof</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">)</span>
<span class="w">            </span><span class="n">shouldStop</span>
<span class="w">          </span><span class="k">else</span>
<span class="w">            </span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">get</span><span class="p">),</span><span class="w"> </span><span class="n">extractContS</span><span class="p">(</span><span class="n">step</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">          </span><span class="n">shouldStop</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span>

<span class="w">      </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">itr</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="n">eval</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">})(</span><span class="n">stopOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">_3</span><span class="p">)</span>
</code></pre></div>
<p>and</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">foldIM</span><span class="p">[</span><span class="nc">ACC</span><span class="p">,</span><span class="nc">F</span><span class="p">,(</span><span class="nc">ACC</span><span class="p">,</span><span class="w"> </span><span class="nc">ResumableIter</span><span class="p">[</span><span class="nc">E</span><span class="p">,</span><span class="nc">F</span><span class="p">,</span><span class="nc">A</span><span class="p">],</span><span class="w"> </span><span class="nc">Boolean</span><span class="p">)]((</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">step</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">itr</span><span class="p">.</span><span class="n">value</span>
<span class="w">      </span><span class="n">isdone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDoneS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="w">      </span><span class="n">iseof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isEOFS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

<span class="w">      </span><span class="n">shouldStop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>

<span class="w">      </span><span class="n">res</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isdone</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">iseof</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">)</span>
<span class="w">            </span><span class="n">shouldStop</span>
<span class="w">          </span><span class="k">else</span>
<span class="w">            </span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">get</span><span class="p">),</span><span class="w"> </span><span class="n">extractContS</span><span class="p">(</span><span class="n">step</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">          </span><span class="n">shouldStop</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span>

<span class="w">      </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">itr</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="n">eval</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">})(</span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">initAcc</span><span class="p">,</span><span class="w"> </span><span class="n">starter</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"> </span><span class="n">stopOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">_3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">repeat</span><span class="p">[</span><span class="nc">ACC</span><span class="p">,</span><span class="nc">F</span><span class="p">](</span><span class="n">initAcc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>
<h3 id="upgrading-to-monadic-usage">Upgrading to Monadic usage<a class="headerlink" href="#upgrading-to-monadic-usage" title="Permanent link">¶</a></h3>
<p>IterV would allow non-monadic usage with tail recursion, this is no longer directly possible in Scalaz 7 IterateeT usage.  A "great" example of this is the foldOnDone method implementation, the original IterV based code is fairly simple:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">currentI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initResumable</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="n">eval</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">isdone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDone</span><span class="p">(</span><span class="n">currentI</span><span class="p">)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">currentA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initAcc</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isdone</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">isdone</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isEOF</span><span class="p">(</span><span class="n">currentI</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isdone</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extract</span><span class="p">(</span><span class="n">currentI</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">.</span><span class="n">isDefined</span><span class="p">)</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">currentA</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">currentA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">get</span><span class="p">)</span>
<span class="w">          </span><span class="n">currentI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractCont</span><span class="p">(</span><span class="n">currentI</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="n">currentI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentI</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="n">eval</span>
<span class="w">      </span><span class="n">isdone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDone</span><span class="p">(</span><span class="n">currentI</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">currentA</span>
</code></pre></div>
<p>i.e. keep extracting the next continuation and call the f fold function when you find a done.  The code runs fast (400ms on the dev box) and in constant space, as you'd expect.  An "obvious" translation to a monadic version is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">starter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">initResumable</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="n">eval</span>

<span class="kd">val</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="n">foldIM</span><span class="p">[</span><span class="nc">ACC</span><span class="p">,</span><span class="nc">F</span><span class="p">,(</span><span class="nc">ACC</span><span class="p">,</span><span class="w"> </span><span class="nc">ResumableIter</span><span class="p">[</span><span class="nc">E</span><span class="p">,</span><span class="nc">F</span><span class="p">,</span><span class="nc">A</span><span class="p">],</span><span class="w"> </span><span class="nc">Boolean</span><span class="p">)]((</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">isdone</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">isDone</span><span class="p">(</span><span class="n">itr</span><span class="p">)</span>
<span class="w">      </span><span class="n">iseof</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">isEOF</span><span class="p">(</span><span class="n">itr</span><span class="p">)</span>

<span class="w">      </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isdone</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">iseof</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extract</span><span class="p">(</span><span class="n">itr</span><span class="p">)</span>
<span class="w">          </span><span class="nc">F</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">.</span><span class="n">isDefined</span><span class="p">)</span>
<span class="w">              </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">              </span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">get</span><span class="p">),</span><span class="w"> </span><span class="n">extractCont</span><span class="p">(</span><span class="n">itr</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">           </span><span class="nc">F</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span>

<span class="w">      </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">itr</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="n">eval</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">})(</span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">initAcc</span><span class="p">,</span><span class="w"> </span><span class="n">starter</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"> </span><span class="n">stopOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">_3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">repeat</span><span class="p">[</span><span class="nc">ACC</span><span class="p">,</span><span class="nc">F</span><span class="p">](</span><span class="n">initAcc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">run</span>

<span class="nc">F</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="p">((</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">),</span><span class="w"> </span><span class="n">cont</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span>
<span class="w">  </span><span class="n">acc</span>
<span class="p">}</span>
</code></pre></div>
<p>We have to loop, so we use a fold with an early exit and drive it through a never ending enumerator (whose value "p" above is ignored), unlike foldI, foldIM expects an accumulator wrapped in the monad.  As we are looping we cannot return and have to handle all exit criteria directly, so more "if" branches are introduced.</p>
<p>Finally, as we must stay in the monad there is lots of direct map/point and of course the hidden bind/flatmaps.  This code runs <em>very</em> slowly - 20 seconds (on the dev box), we've gone from a non-monadic version at 400ms to 20s, why?</p>
<p><a href="https://stackoverflow.com/a/41128527/1028537">This SO post</a> does an excellent job of explaining how seemingly innocuous and correct code can become a very large chain of O(N) calls under the hood.  This version of "r" brings us back to the 400-450ms mark (still a bit slower but no SOEs and monadic):</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">(</span><span class="n">foldIM</span><span class="p">[</span><span class="nc">ACC</span><span class="p">,</span><span class="nc">F</span><span class="p">,(</span><span class="nc">ACC</span><span class="p">,</span><span class="w"> </span><span class="nc">ResumableIter</span><span class="p">[</span><span class="nc">E</span><span class="p">,</span><span class="nc">F</span><span class="p">,</span><span class="nc">A</span><span class="p">],</span><span class="w"> </span><span class="nc">Boolean</span><span class="p">)]((</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">step</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">itr</span><span class="p">.</span><span class="n">value</span>
<span class="w">      </span><span class="n">isdone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDoneS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="w">      </span><span class="n">iseof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isEOFS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

<span class="w">      </span><span class="n">shouldStop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>

<span class="w">      </span><span class="n">res</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isdone</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">iseof</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractS</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">)</span>
<span class="w">            </span><span class="n">shouldStop</span>
<span class="w">          </span><span class="k">else</span>
<span class="w">            </span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">get</span><span class="p">),</span><span class="w"> </span><span class="n">extractContS</span><span class="p">(</span><span class="n">step</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">          </span><span class="n">shouldStop</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="n">itr</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span>

<span class="w">      </span><span class="p">(</span><span class="n">currentA</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">itr</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">e</span><span class="p">).</span><span class="n">eval</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">})(</span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">initAcc</span><span class="p">,</span><span class="w"> </span><span class="n">starter</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"> </span><span class="n">stopOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">_3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">repeat</span><span class="p">[</span><span class="nc">ACC</span><span class="p">,</span><span class="nc">F</span><span class="p">](</span><span class="n">initAcc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">run</span>
</code></pre></div>
<p>Here, instead of 2 flatmaps and 1 flatmap containing a map that is also mapped we are left with only one flatmap - that of the underlying step.  To enable this there are now new functions ending in S designed to behave like the old IterV based function and stay out of monads.  If your code runs slower than expected this is a likely culprit. </p>
<h3 id="a-note-on-id-trampoline-and-io">A note on Id, Trampoline and IO<a class="headerlink" href="#a-note-on-id-trampoline-and-io" title="Permanent link">¶</a></h3>
<p>Although the base Monad types have a consistent API actually running them is inconsistent (as can be using them in for loops - make sure to import scalaz.Scalaz._).  Id doesn't actually get run, Trampoline/Free has a run function and IO has an unsafePerformIO.</p>
<p>This makes code a little fragile to simply swap out implementations despite the handy monad specific iteratee imports.  As such Scales also adds the scales.utils.monadHelpers._ imports which provides wrappers for these behaviours, with run/unsafePerformIO becoming "runIt" (perform is taken by Scalaz for common imports).</p>
<p>Note: you'll have to use p.runIt:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">utils</span><span class="p">.</span><span class="nn">iteratee</span><span class="p">.</span><span class="nn">monadHelpers</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">scalaz</span><span class="p">.</span><span class="nc">Scalaz</span><span class="p">.</span><span class="n">_</span>
<span class="kd">val</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doSomethingReturningAnFofA</span>

<span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">runIt</span>
</code></pre></div>
<p>In order to make re-usable code specify the correct implicits, including the correct monad iteratees:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">theResuableCode</span><span class="p">[</span><span class="nc">F</span><span class="p">[</span><span class="n">_</span><span class="p">]:</span><span class="w"> </span><span class="nc">Monad</span><span class="p">:</span><span class="w"> </span><span class="nc">IterateeFunctions</span><span class="p">:</span><span class="w"> </span><span class="nc">CanRunIt</span><span class="p">]():</span><span class="w"> </span><span class="nc">F</span><span class="p">[</span><span class="nc">SomeResult</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span>
<span class="p">}</span>
</code></pre></div>
<p>It is suggested that CanRunIt is only used in testing, rather prefer to bring the actual state change, of running the monad, to the edges of your code where you probably know which monad you are using.</p>
<h3 id="beware-the-iterator">BEWARE THE ITERATOR<a class="headerlink" href="#beware-the-iterator" title="Permanent link">¶</a></h3>
<p>As Trampolining is now used anything that generates with side effects e.g. Iterator[PullType] can case significant oddities as one part of the code you'd reasoned is finished starts up again and calls next.</p>
<p>In order to aid this there is a memory and state trade off to be had and wrapping the iterator in EphemeralStream.  To aid this three functions are introduced:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">scales</span><span class="p">.</span><span class="nn">utils</span><span class="p">.</span><span class="n">iteratee</span>

<span class="k">object</span><span class="w"> </span><span class="nc">EphemeralStreamEnum</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">enumEphemeralStream</span><span class="p">[</span><span class="nc">E</span><span class="p">,</span><span class="w"> </span><span class="nc">F</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Monad</span><span class="p">](</span><span class="n">xs</span><span class="p">:</span><span class="w"> </span><span class="nc">EphemeralStream</span><span class="p">[</span><span class="nc">E</span><span class="p">]):</span><span class="w"> </span><span class="nc">EnumeratorT</span><span class="p">[</span><span class="nc">E</span><span class="p">,</span><span class="w"> </span><span class="nc">F</span><span class="p">]</span>

<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">enumEphemeralStreamF</span><span class="p">[</span><span class="nc">E</span><span class="p">,</span><span class="w"> </span><span class="nc">F</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Monad</span><span class="p">](</span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="nc">EphemeralStream</span><span class="p">[</span><span class="nc">E</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Unit</span><span class="p">)(</span><span class="n">xs</span><span class="p">:</span><span class="w"> </span><span class="nc">EphemeralStream</span><span class="p">[</span><span class="nc">E</span><span class="p">]):</span><span class="w"> </span><span class="nc">EnumeratorT</span><span class="p">[</span><span class="nc">E</span><span class="p">,</span><span class="w"> </span><span class="nc">F</span><span class="p">]</span>

<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">toEphemeral</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="n">iterator</span><span class="p">:</span><span class="w"> </span><span class="nc">Iterator</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span><span class="w"> </span><span class="nc">EphemeralStream</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>toEphemeral safely wraps an iterator in EphemeralStream ensuring trampolining does not trigger more .next calls.</p>
<p>The enumEphemeralStreamF variant lets you use a workaround to keep the progress and restart processing the stream:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">theStream</span><span class="p">:</span><span class="w"> </span><span class="nc">EphemeralStream</span><span class="p">[</span><span class="nc">PullType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toEphemeral</span><span class="p">(</span><span class="n">xmlpull</span><span class="p">:</span><span class="w"> </span><span class="nc">Iterator</span><span class="p">[</span><span class="nc">PullType</span><span class="p">])</span>
<span class="kd">val</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">EphemeralStream</span><span class="p">[</span><span class="nc">PullType</span><span class="p">])</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">enum</span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">EphemeralStream</span><span class="p">[</span><span class="nc">PullType</span><span class="p">])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">enumEphemeralStreamF</span><span class="p">[</span><span class="nc">PullType</span><span class="p">,</span><span class="w"> </span><span class="nc">TheF</span><span class="p">](</span><span class="n">func</span><span class="p">)(</span><span class="n">e</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">starter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ionDone</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="k">enum</span><span class="p">(</span><span class="n">theStream</span><span class="p">)).</span><span class="n">eval</span>

<span class="c1">// some time later, restart the stream processing</span>
<span class="p">(</span><span class="n">extractCont</span><span class="p">(</span><span class="n">starter</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="k">enum</span><span class="p">(</span><span class="n">theStream</span><span class="p">)).</span><span class="n">eval</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Consider iteratee composition</p>
<p>If you are using iteratee's already consider composing them via for and only processing the stream once (i.e. not using extractCont) if intermediate values aren't needed.</p>
</div>
<h3 id="beware-side-effecting-output-state-as-well">Beware Side Effecting Output State as well<a class="headerlink" href="#beware-side-effecting-output-state-as-well" title="Permanent link">¶</a></h3>
<p>Although you may have written your iteratee's in a functional fashion (passing state to the next steps) if you are using side effecting state (like the base use case of processing a stream of xml pull events) if you are not running your IterateeT with ".run" you may fall afoul of trampolining restarting your state.</p>
<p>This can be seen as duplicate events being sent or, as a result, events seemingly being out of order.  This is does not happen when running in Id or (at least it has not be observed to be the case) when using .run.</p>
<p>Using eval or evalAcceptEmpty to process continuations of the stream when faced with empty (instead of Eof as with .run) can leave the iteratee needing to restart outside of the trampoline mechanism.  As of Scalaz 7.3.8 this triggers restarts of at least the previous iteratee - not the resulting next cont (again this does not happen with Id).  </p>
<p>As counter-intuitive as it seems this requires managing duplicate feed detection in the iteratee.  Both pushXmlIter and AsyncParser face this issue, state is moved to a var closure and next inputs are checked against the previous inputs.  Given their use cases this is acceptable, each iteratee that manages state needs to verify this.</p>
<p>It is highly likely this behaviour is tied to that of the above iterator warning and possibly some bug.</p>
<h2 id="scala-213-support">Scala 2.13 support<a class="headerlink" href="#scala-213-support" title="Permanent link">¶</a></h2>
<p>2.13 re-worked much of the internal collection logic, including CanBuildFrom.  Scales required the ability to swap out the actual container used for Tree's in order to reduce allocation cost (yielding better performance).</p>
<p>As such there is a compatibility layer working around most of this unpleasantness, however for compatibility CanBuildfrom is still implicitly required in the apis.</p>
<p>None of this should affect 2.13 usage but please raise an issue should you find one.</p>
<hr/>
<div class="md-source-file">
<small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">January 15, 2024 16:35:25</span>
<br/>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">January 15, 2024 16:35:25</span>
</small>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "navigation.expand", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
<script src="../../../assets/javascripts/bundle.fc8c2696.min.js"></script>
</body>
</html>